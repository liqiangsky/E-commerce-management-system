{"remainingRequest":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\我的git\\E-commerce-management-system\\dianshangsystem\\src\\components\\Roles.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\src\\components\\Roles.vue","mtime":1609319802773},{"path":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\我的git\\E-commerce-management-system\\dianshangsystem\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmJvcmRlci10b3Agew0KICBib3JkZXItdG9wOiAxcHggc29saWQgI2UzZTNlMzsNCn0NCi5ib3JkZXItYm90dG9tIHsNCiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlM2UzZTM7DQp9DQouY2VudGVyIHsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCg=="},{"version":3,"sources":["Roles.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Roles.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"roles\">\r\n    <el-breadcrumb separator=\"/\">\r\n      <el-breadcrumb-item :to=\"{ path: '/welcome' }\">首页</el-breadcrumb-item>\r\n      <el-breadcrumb-item>权限管理</el-breadcrumb-item>\r\n      <el-breadcrumb-item>角色列表</el-breadcrumb-item>\r\n    </el-breadcrumb>\r\n    <el-card class=\"m-t-20\">\r\n      <el-button type=\"primary\" @click=\"Operation('Add')\">添加角色</el-button>\r\n      <el-table\r\n        :data=\"tableData\"\r\n        v-loading=\"loading\"\r\n        border\r\n        style=\"width: 100%\"\r\n        class=\"m-t-20\"\r\n      >\r\n        <el-table-column width=\"50\" type=\"expand\">\r\n          <template slot-scope=\"scope\">\r\n            <el-row\r\n              class=\"center\"\r\n              v-for=\"(i, index) in scope.row.children\"\r\n              :key=\"i.id + i.authName\"\r\n              :class=\"['border-bottom', index === 0 ? 'border-top' : '']\"\r\n            >\r\n              <!-- 一级权限 -->\r\n              <el-col :span=\"4\">\r\n                <el-tag\r\n                  type=\"danger\"\r\n                  closable\r\n                  @close=\"CloseTag(scope.row, i, scope.row.children)\"\r\n                  class=\"m-10\"\r\n                  >{{ i.authName }}</el-tag\r\n                >\r\n                <i class=\"el-icon-caret-right\"></i>\r\n              </el-col>\r\n              <!-- 二级权限 -->\r\n              <el-col :span=\"20\">\r\n                <el-row\r\n                  v-for=\"(j, index) in i.children\"\r\n                  :key=\"j.id + j.authName\"\r\n                  :class=\"[index !== 0 ? 'border-top' : '']\"\r\n                >\r\n                  <el-col :span=\"4\">\r\n                    <el-tag\r\n                      type=\"success\"\r\n                      closable\r\n                      @close=\"CloseTag(scope.row, j, i.children)\"\r\n                      class=\"m-10\"\r\n                      >{{ j.authName }}</el-tag\r\n                    >\r\n                    <i class=\"el-icon-caret-right\"></i>\r\n                  </el-col>\r\n                  <!-- 三级权限 -->\r\n                  <el-col :span=\"20\">\r\n                    <el-tag\r\n                      type=\"warning\"\r\n                      closable\r\n                      @close=\"CloseTag(scope.row, k, j.children)\"\r\n                      class=\"m-10\"\r\n                      v-for=\"k in j.children\"\r\n                      :key=\"k.id + k.authName\"\r\n                      >{{ k.authName }}</el-tag\r\n                    >\r\n                  </el-col>\r\n                </el-row>\r\n              </el-col>\r\n            </el-row>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"#\" width=\"50\" type=\"index\"></el-table-column>\r\n        <el-table-column label=\"角色名称\" prop=\"roleName\"> </el-table-column>\r\n        <el-table-column label=\"角色描述\" prop=\"roleDesc\"></el-table-column>\r\n        <el-table-column label=\"操作\" width=\"300\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button\r\n              type=\"primary\"\r\n              icon=\"el-icon-edit\"\r\n              size=\"small\"\r\n              @click=\"Operation('Edit', scope.row)\"\r\n              >编辑</el-button\r\n            >\r\n            <el-button\r\n              type=\"danger\"\r\n              icon=\"el-icon-delete\"\r\n              size=\"small\"\r\n              @click=\"Delete(scope.row)\"\r\n              >删除</el-button\r\n            >\r\n            <el-button\r\n              type=\"warning\"\r\n              icon=\"el-icon-s-tools\"\r\n              size=\"small\"\r\n              @click=\"Operation('Setting', scope.row)\"\r\n              >分配权限</el-button\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <el-dialog\r\n        :title=\"title\"\r\n        :visible.sync=\"dialogVisible\"\r\n        width=\"50%\"\r\n        :destroy-on-close=\"true\"\r\n      >\r\n        <el-form\r\n          ref=\"RoleForm\"\r\n          :model=\"RoleForm\"\r\n          :rules=\"rules\"\r\n          label-width=\"80px\"\r\n          v-show=\"title !== '分配权限'\"\r\n        >\r\n          <el-form-item label=\"角色名称\" prop=\"roleName\">\r\n            <el-input\r\n              v-model=\"RoleForm.roleName\"\r\n              placeholder=\"请输入角色名称\"\r\n            ></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"角色描述\">\r\n            <el-input\r\n              v-model=\"RoleForm.roleDesc\"\r\n              placeholder=\"请输入角色描述\"\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <el-tree\r\n          ref=\"RoleTree\"\r\n          :data=\"data\"\r\n          show-checkbox\r\n          node-key=\"id\"\r\n          :props=\"defaultProps\"\r\n          :default-checked-keys=\"GetCheck\"\r\n          default-expand-all\r\n          v-show=\"title === '分配权限'\"\r\n        ></el-tree>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n          <el-button type=\"primary\" @click=\"SubmitForm(FormName)\"\r\n            >确 定</el-button\r\n          >\r\n        </span>\r\n      </el-dialog>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      tableData: [],\r\n      data: [],\r\n      dialogVisible: false,\r\n      title: \"\",\r\n      FormName: \"\",\r\n      type: \"success\",\r\n      message: \"获取角色列表成功！\",\r\n      GetCheck: [],\r\n      RoleForm: {\r\n        id: \"\",\r\n        roleName: \"\",\r\n        roleDesc: \"\",\r\n      },\r\n      defaultProps: {\r\n        children: \"children\",\r\n        label: \"authName\",\r\n      },\r\n      rules: {\r\n        roleName: [\r\n          { required: true, message: \"请输入角色名称\", trigger: \"blur\" },\r\n        ],\r\n      },\r\n    };\r\n  },\r\n  created() {\r\n    this.Roles();\r\n  },\r\n  methods: {\r\n    async Roles() {\r\n      this.loading = true;\r\n      const res = await this.$http.get(\"roles\");\r\n      if (res.meta.status == 200) {\r\n        this.$message({\r\n          type: this.type,\r\n          message: this.message,\r\n        });\r\n        this.tableData = res.data;\r\n        this.loading = false;\r\n      }\r\n    },\r\n    async Operation(type, row) {\r\n      switch (type) {\r\n        case \"Add\":\r\n          this.title = \"添加角色\";\r\n          this.FormName = \"RoleForm\";\r\n          break;\r\n        case \"Edit\":\r\n          this.title = \"修改角色\";\r\n          this.FormName = \"RoleForm\";\r\n          this.RoleForm.id = row.id;\r\n          this.RoleForm.roleName = row.roleName;\r\n          this.RoleForm.roleDesc = row.roleDesc;\r\n          break;\r\n        case \"Setting\":\r\n          this.title = \"分配权限\";\r\n          this.RoleForm.id = row.id;\r\n          this.FormName = \"RoleTree\";\r\n          this.GetCheck = [];\r\n          this.GetCheckList(row, this.GetCheck);\r\n          var res = await this.$http.get(\"rights/tree\");\r\n          this.data = res.data;\r\n      }\r\n      this.dialogVisible = true;\r\n    },\r\n    //三级权限所有id,递归函数\r\n    GetCheckList(node, arr) {\r\n      if (!node.children) {\r\n        return arr.push(node.id);\r\n      }\r\n      node.children.forEach((item) => this.GetCheckList(item, arr));\r\n    },\r\n    CloseTag(row, right, arr) {\r\n      this.$confirm(\"此操作将永久删除该文件, 是否继续?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(async () => {\r\n          const res = await this.$http.delete(\r\n            `roles/${row.id}/rights/${right.id}`\r\n          );\r\n          if (res.meta.status == 200) {\r\n            arr.splice(arr.indexOf(right), 1);\r\n            this.$message({\r\n              type: \"success\",\r\n              message: \"取消分配权限成功！\",\r\n            });\r\n            this.dialogVisible = false;\r\n          }\r\n        })\r\n        .catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消删除\",\r\n          });\r\n        });\r\n    },\r\n    async SubmitForm(formName) {\r\n      if (formName === \"RoleTree\") {\r\n        const arr = [\r\n          ...this.$refs[formName].getCheckedKeys(),\r\n          ...this.$refs[formName].getHalfCheckedKeys(),\r\n        ];\r\n        const res = await this.$http.post(`roles/${this.RoleForm.id}/rights`, {\r\n          rids: arr.join(\",\"),\r\n        });\r\n        if (res.meta.status == 200) {\r\n          this.type = \"success\";\r\n          this.message = \"分配权限成功！\";\r\n          this.dialogVisible = false;\r\n          this.Roles();\r\n        } else {\r\n          this.type = \"error\";\r\n          this.message = \"error\";\r\n        }\r\n      } else {\r\n        this.$refs[formName].validate(async (valid) => {\r\n          if (valid) {\r\n            switch (this.title) {\r\n              case \"添加角色\":\r\n                var res = await this.$http.post(\"roles\", this.RoleForm);\r\n                if (res.meta.status == 201) {\r\n                  this.type = \"success\";\r\n                  this.message = \"添加角色信息成功！\";\r\n                  this.Roles();\r\n                  this.dialogVisible = false;\r\n                } else {\r\n                  this.type = \"error\";\r\n                  this.message = \"error\";\r\n                }\r\n                break;\r\n              case \"修改角色\":\r\n                var res = await this.$http.put(`roles/${this.RoleForm.id}`, {\r\n                  roleName: this.RoleForm.roleName,\r\n                  roleDesc: this.RoleForm.roleDesc,\r\n                });\r\n                if (res.meta.status == 200) {\r\n                  this.type = \"success\";\r\n                  this.message = \"修改角色成功!\";\r\n                  this.Roles();\r\n                  this.dialogVisible = false;\r\n                } else {\r\n                  this.type = \"error\";\r\n                  this.message = \"error\";\r\n                }\r\n                break;\r\n            }\r\n          } else {\r\n            this.$message.error(\"请先按要求填写信息！\");\r\n            return false;\r\n          }\r\n        });\r\n      }\r\n    },\r\n    Delete(row) {\r\n      this.$confirm(\"此操作将永久删除该用户信息, 是否继续?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(async () => {\r\n          const res = await this.$http.delete(`roles/${row.id}`);\r\n          if (res.meta.status == 200) {\r\n            this.type = \"success\";\r\n            this.message = \"删除用户成功！\";\r\n            this.Roles();\r\n            this.dialogVisible = false;\r\n          } else {\r\n            this.type = \"error\";\r\n            this.message = \"error\";\r\n          }\r\n        })\r\n        .catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消删除\",\r\n          });\r\n        });\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\">\r\n.border-top {\r\n  border-top: 1px solid #e3e3e3;\r\n}\r\n.border-bottom {\r\n  border-bottom: 1px solid #e3e3e3;\r\n}\r\n.center {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n</style>"]}]}